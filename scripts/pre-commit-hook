#!/bin/bash

# Git pre-commit hook - Basketball Scoring App
# Install this by running: cp scripts/pre-commit-hook .git/hooks/pre-commit
# Or: ./scripts/install-hooks.sh

# Exit on error, but don't block commits unless critical
set +e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CHECK_SCRIPT="$SCRIPT_DIR/pre-commit-check.sh"

echo "ğŸ”’ Running pre-commit checks..."

# Run the check script in non-interactive mode
if [ -f "$CHECK_SCRIPT" ]; then
    # Source the script but override the interactive parts
    source "$CHECK_SCRIPT" --non-interactive 2>/dev/null || {
        echo "âš ï¸  Pre-commit check script not fully compatible with hook mode"
        echo "   Running basic checks..."
        
        # Fallback: just run tests and lint
        npm test -- --run &>/dev/null || {
            echo "âŒ Tests failed"
            exit 1
        }
    }
else
    echo "âš ï¸  Pre-commit check script not found at: $CHECK_SCRIPT"
    echo "   Running basic checks..."
    
    npm test -- --run &>/dev/null || {
        echo "âŒ Tests failed"
        exit 1
    }
fi

echo "âœ… Pre-commit checks passed!"
